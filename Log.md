开发日志
8-10  
- 解决C#调用C++写的动态链接库
两个语言之间并不是无缝的   

c#调用c++动态库一般这样写  

`[DllImport("UCamer.dll", CallingConvention = CallingConvention.Winapi)]`  
`public extern static void Disp_Destroy(IntPtr hShow);`  
DllImport的第一个参数UCamer.dll是动态库dll的路径，此dll放在程序运行的根目录或者c:windows/sytem32下
CallingConvention 参数是c#调用c++的方式 是个枚举 msdn解释如下:  

Cdecl 		调用方清理堆栈。这使您能够调用具有 varargs 的函数（如 Printf），使之可用于接受可变数目的参数的方法。   
FastCall 	不支持此调用约定。  
StdCall		被调用方清理堆栈。这是使用平台 invoke 调用非托管函数的默认约定。   
ThisCall	第一个参数是 this 指针，它存储在寄存器 ECX 中。其他参数被推送到堆栈上。此调用约定用于对从非托管 DLL 导出的类调用方法。   
Winapi 		此成员实际上不是调用约定，而是使用了默认平台调用约定。例如，在 Windows 上默认为 StdCall，在 Windows CE.NET 上默认为 Cdecl。   

静态库和动态库  

静态库：函数和数据被编译进一个二进制文件（扩展名通常为.lib）,在使用静态库的情况下，在编译链接可执行文件时，
链接器从静态库中复制这些函数和数据，并把它们和应用程序的其他模块组合起来创建最终的可执行文件（.exe）。当发布产品时，
只需要发布这个可执行文件，并不需要发布被使用的静态库。

动态库：在使用动态库时，往往提供两个文件：一个引入库（.lib，非必须）和一个.dll文件。这里的引入库和静态库文件虽然扩展名都是.lib，
但是有着本质上的区别，对于一个动态链接库来说，其引入库文件包含该动态库导出的函数和变量的符号名，而.dll文件包含该动态库实际的函数和数据。　　

使用动态链接库的好处

1、可以使用多种编程语言编写：比如我们可以用VC++编写dll，然后在VB编写的程序中调用它。
2、增强产品功能：可以通过开发新的dll取代产品原有的dll，达到增强产品性能的目的。比如我们看到很多产品踢动了界面插件功能，
	允许用户动态地更换程序的界面，这就可以通过更换界面dll来实现。
3、提供二次开发的平台：用户可以单独利用dll调用其中实现的功能，来完成其他应用，实现二次开发。
4、节省内存：如果多个应用程序使用同一个dll，该dll的页面只需要存入内存一次，所有的应用程序都可以共享它的页面，从而节省内存。

使用模块定义(.def)文件创建dll

使用def文件创建dll的话就不再需要__declspec(dllexport)，因此将代码写成最原始的样子：
```
int add(int a, int b){
    return a + b;
}

int subtract(int a, int b){
    return a - b;
}
```

同时为工程创建一个后缀名为.def的文件，并添加进工程，编辑其内容为：  
```
LIBRARY Dll1

EXPORTS
add
subtract
```
其中LIBRARY语句用于指定动态链接库的名称，该名称与生成的动态链接库名称一定要匹配。EXPORTS语句用于表明dll将要导出的函数，以及为这些导出函数指定的符号名。 
将该模块定义文件链接到工程中，方法为工程属性页面>链接器>输入>模块定义文件中写入“Dll1.def”。

托管和非托管

C++是非托管代码，C#是托管代码，若C#要调用C++的话，需要将C#代码封装成托管代码，编译成dll才可以使用。
托管代码 (managed code) :由公共语言运行库环境（cls而不是直接由操作系统）执行的代码。托管代码应用程序可以获得公共语言运行库服务，例如自动垃圾回收、运行库类型检查和安全支持等。这些服务帮助提供独立于平台和语言的、统一的托管代码应用程序行为。
非托管代码 (Unmanaged Code) :在公共语言运行库(cls)环境的外部，由操作系统直接执行的代码。非托管代码必须提供自己的垃圾回收、类型检查、安全支持等服务；它与托管代码不同，后者从公共语言运行库中获得这些服务。非托管代码的英文名是Unmanaged Code ，它是在公共语言运行库环境的外部，由操作系统直接执行的代码。

托管申请的资源由.netframework统一管理，非托管申请的内存资源需要手动释放。
非托管运行很快，二进制


解决方案：
分别生成MATLAB, C++, C# 的动态链接库  